name: Keep App Awake

on:
  schedule:
    # Run every 5 minutes (minimum allowed by GitHub)
    - cron: '*/5 * * * *'
  workflow_dispatch: # Allows manual triggering from GitHub UI

jobs:
  ping:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    
    steps:
      - name: Ping health endpoint
        run: |
          echo "üè• Pinging health endpoint..."
          for i in {1..3}; do
            echo "Attempt $i of 3"
            response=$(curl -s -o /dev/null -w "%{http_code}" -m 60 https://hwb-votes.onrender.com/api/health)
            echo "Response: $response"
            
            if [ $response -eq 200 ] || [ $response -eq 304 ]; then
              echo "‚úÖ Health check passed!"
              break
            else
              echo "‚ö†Ô∏è Retrying..."
              sleep 10
            fi
          done
          
      - name: Ping API endpoint
        run: |
          echo "ÔøΩ Pinging API endpoint..."
          response=$(curl -s -m 60 https://hwb-votes.onrender.com/api/photos | head -c 100)
          echo "API Response preview: $response"
          echo "‚úÖ API endpoint responding!"
      
      - name: Log timestamp
        run: |
          echo "‚è∞ Keep-alive ping completed at: $(date -u '+%Y-%m-%d %H:%M:%S UTC')"
